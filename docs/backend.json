
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the Sakhi Circle application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
            "type": "string",
            "description": "The user's unique, public-facing username (e.g., @priyasharma)."
        },
        "aadhaarVerified": {
          "type": "boolean",
          "description": "Indicates if the user has been verified using Aadhaar (optional)."
        },
        "verificationStatus": {
          "type": "string",
          "description": "The user's verification status (e.g., pending, verified, rejected)."
        },
        "interests": {
          "type": "array",
          "description": "User's interests and hobbies.",
          "items": {
            "type": "string"
          }
        },
        "profession": {
            "type": "string",
            "description": "User's profession or work status.",
            "enum": ["Working Professional", "Homemaker", "Student", "Business Owner", "Looking for work"]
        },
        "education": {
            "type": "string",
            "description": "User's educational background."
        },
        "maritalStatus": {
            "type": "string",
            "description": "User's marital status.",
            "enum": ["Single", "Married", "Divorced", "In a Relationship", "Widowed"]
        },
        "location": {
          "type": "string",
          "description": "User's city-level location (for safety)."
        },
        "lookingToConnectFor": {
          "type": "array",
          "description": "User's reasons for connecting (friends, business, learning, etc.).",
          "items": {
            "type": "string"
          }
        },
        "followerIds": {
            "type": "array",
            "description": "List of user IDs who are following this user.",
            "items": { "type": "string" }
        },
        "followingIds": {
            "type": "array",
            "description": "List of user IDs this user is following.",
            "items": { "type": "string" }
        }
      },
      "required": [
        "id"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a post in the Sakhi Circle application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Post entity."
        },
        "author": {
          "type": "object",
          "description": "Denormalized author information for performance.",
          "properties": {
            "id": { "type": "string" },
            "name": { "type": "string" },
            "avatar": { "type": "string" }
          },
          "required": ["id", "name"]
        },
        "content": {
          "type": "string",
          "description": "Content of the post (text)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the post was created. Should be a server timestamp.",
          "format": "date-time"
        },
        "likes": {
          "type": "number",
          "description": "Number of likes."
        },
        "image": {
          "type": "string",
          "description": "URL of an image attached to the post (optional)."
        },
        "isAnonymous": {
          "type": "boolean",
          "description": "True if the post is made anonymously."
        },
        "pollOptions": {
          "type": "array",
          "description": "Options for a poll (optional).",
          "items": {
            "type": "object",
            "properties": {
              "text": { "type": "string" },
              "votes": { "type": "number" }
            },
            "required": ["text", "votes"]
          }
        }
      },
      "required": [
        "id",
        "author",
        "content",
        "timestamp",
        "likes",
        "isAnonymous"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a chat between two or more users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Chat entity."
        },
        "participants": {
          "type": "array",
          "description": "References to UserProfiles participating in the chat. (Relationship: UserProfile N:N Chat)",
          "items": {
            "type": "string"
          }
        },
        "type": {
          "type": "string",
          "description": "Type of chat (1:1 or group)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the chat was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "participants",
        "type",
        "createdAt"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a message within a chat.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Message entity."
        },
        "chatId": {
          "type": "string",
          "description": "Reference to Chat. (Relationship: Chat 1:N Message)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to UserProfile who sent the message. (Relationship: UserProfile 1:N Message)"
        },
        "content": {
          "type": "string",
          "description": "Content of the message (text, image URL, video URL, voice note URL)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "chatId",
        "senderId",
        "content",
        "timestamp"
      ]
    },
    "Community": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Community",
      "type": "object",
      "description": "Represents a community in the Sakhi Circle application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the community."
        },
        "description": {
          "type": "string",
          "description": "Description of the community."
        },
        "type": {
          "type": "string",
          "description": "Type of community (interest-based, life-stage, city-based)."
        },
        "leaderId": {
          "type": "string",
          "description": "Reference to UserProfile who is the leader of the community. (Relationship: UserProfile 1:N Community)"
        },
        "memberIds": {
          "type": "array",
          "description": "References to UserProfiles who are members of the community. (Relationship: UserProfile N:N Community)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "type",
        "leaderId"
      ]
    },
    "KittyGroup": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "KittyGroup",
      "type": "object",
      "description": "Represents a digital kitty group.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the KittyGroup entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the kitty group."
        },
        "memberIds": {
          "type": "array",
          "description": "References to UserProfiles who are members of the kitty group. (Relationship: UserProfile N:N KittyGroup)",
          "items": {
            "type": "string"
          }
        },
        "contributionAmount": {
          "type": "number",
          "description": "Monthly kitty contribution amount."
        },
        "nextWinnerSelectionDate": {
          "type": "string",
          "description": "Date of the next winner selection.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "memberIds",
        "contributionAmount",
        "nextWinnerSelectionDate"
      ]
    },
    "MarketplaceListing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MarketplaceListing",
      "type": "object",
      "description": "Represents a listing in the women's business marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MarketplaceListing entity."
        },
        "sellerId": {
          "type": "string",
          "description": "Reference to UserProfile who is selling the product/service. (Relationship: UserProfile 1:N MarketplaceListing)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product/service."
        },
        "description": {
          "type": "string",
          "description": "Description of the product/service."
        },
        "price": {
          "type": "number",
          "description": "Price of the product/service."
        },
        "category": {
          "type": "string",
          "description": "Category of the product/service (food, handmade, fashion, etc.)."
        }
      },
      "required": [
        "id",
        "sellerId",
        "name",
        "description",
        "price",
        "category"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a learning course in the Sakhi Circle application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "title": {
          "type": "string",
          "description": "Name of the course."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        },
        "instructorId": {
          "type": "string",
          "description": "Reference to UserProfile who is the instructor of the course. (Relationship: UserProfile 1:N Course)"
        },
        "enrolledUserIds": {
          "type": "array",
          "description": "References to UserProfiles who are enrolled in the course. (Relationship: UserProfile N:N Course)",
          "items": {
            "type": "string"
          }
        },
        "category": {
            "type": "string",
            "description": "Category of the course (e.g., Business, Beauty, Wellness)."
        },
        "level": {
            "type": "string",
            "description": "Difficulty level of the course (e.g., Beginner, Intermediate)."
        },
        "duration": {
            "type": "string",
            "description": "Estimated duration to complete the course."
        },
        "price": {
            "type": "number",
            "description": "Price of the course. 0 indicates free."
        },
        "image": {
            "type": "string",
            "description": "URL for the course's cover image."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "instructorId",
        "category",
        "level",
        "duration",
        "price",
        "image"
      ]
    },
    "Event": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Event",
      "type": "object",
      "description": "Represents an event in the Sakhi Circle application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Event entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the event."
        },
        "description": {
          "type": "string",
          "description": "Description of the event."
        },
        "organizerId": {
          "type": "string",
          "description": "Reference to UserProfile who is organizing the event. (Relationship: UserProfile 1:N Event)"
        },
        "attendeeIds": {
          "type": "array",
          "description": "References to UserProfiles who are attending the event. (Relationship: UserProfile N:N Event)",
          "items": {
            "type": "string"
          }
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time of the event.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "Location of the event."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "organizerId",
        "dateTime",
        "location"
      ]
    },
    "Professional": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Professional",
      "type": "object",
      "description": "Represents a professional in the support directory.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "avatar": { "type": "string", "format": "uri" },
        "specialties": { "type": "array", "items": { "type": "string" } },
        "description": { "type": "string" },
        "verified": { "type": "boolean" },
        "fees": { "type": "number" }
      },
      "required": ["id", "name", "avatar", "specialties", "description", "verified"]
    },
    "Contest": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Contest",
        "type": "object",
        "description": "Represents a contest or award in the application.",
        "properties": {
            "id": { "type": "string" },
            "title": { "type": "string" },
            "category": { "type": "string" },
            "description": { "type": "string" },
            "prize": { "type": "string" },
            "endsIn": { "type": "string" },
            "image": { "type": "string", "format": "uri" },
            "nominationFee": { "type": "number" },
            "status": { "type": "string", "enum": ["Live", "Ended", "Pending Approval", "Community-run"] }
        },
        "required": ["id", "title", "category", "description", "prize", "endsIn", "image", "nominationFee", "status"]
    },
    "ProfessionalApplication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProfessionalApplication",
      "type": "object",
      "description": "Represents an application from a user to become a professional.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "userName": { "type": "string" },
        "userAvatar": { "type": "string", "format": "uri" },
        "specialty": { "type": "string" },
        "bio": { "type": "string" },
        "status": { "type": "string", "enum": ["pending", "approved", "rejected"] },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "userId", "userName", "specialty", "bio", "status", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userId' parameter is used for path-based ownership, ensuring only the user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores all posts in a top-level collection for easy querying of the main feed.",
          "params": [
             {
              "name": "postId",
              "description": "The unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": {
            "$ref": "#/backend/entities/Chat"
          },
          "description": "Stores chat metadata, including a 'members' map for authorization. Includes denormalized 'members' map for authorization independence.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier for the chat."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages within a chat. Authorization is inherited from the parent chat document.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier for the chat."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the message."
            }
          ]
        }
      },
      {
        "path": "/communities/{communityId}",
        "definition": {
          "entityName": "Community",
          "schema": {
            "$ref": "#/backend/entities/Community"
          },
          "description": "Stores community data, including a 'members' map for authorization. Includes denormalized 'memberIds' array for authorization independence.",
          "params": [
            {
              "name": "communityId",
              "description": "The unique identifier for the community."
            }
          ]
        }
      },
      {
        "path": "/kitty_groups/{kittyGroupId}",
        "definition": {
          "entityName": "KittyGroup",
          "schema": {
            "$ref": "#/backend/entities/KittyGroup"
          },
          "description": "Stores kitty group data, including a 'members' map for authorization. Includes denormalized 'memberIds' array for authorization independence.",
          "params": [
            {
              "name": "kittyGroupId",
              "description": "The unique identifier for the kitty group."
            }
          ]
        }
      },
      {
        "path": "/marketplace_listings/{listingId}",
        "definition": {
          "entityName": "MarketplaceListing",
          "schema": {
            "$ref": "#/backend/entities/MarketplaceListing"
          },
          "description": "Stores marketplace listing data. Includes denormalized 'sellerId' for authorization independence.",
          "params": [
            {
              "name": "listingId",
              "description": "The unique identifier for the marketplace listing."
            }
          ]
        }
      },
      {
        "path": "/directory/{professionalId}",
        "definition": {
          "entityName": "Professional",
          "schema": {
            "$ref": "#/backend/entities/Professional"
          },
          "description": "Stores professional profiles for the support directory.",
          "params": [
            {
              "name": "professionalId",
              "description": "The unique identifier for the professional."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course data. Includes denormalized 'instructorId' and 'enrolledUserIds' for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
       {
        "path": "/contests/{contestId}",
        "definition": {
          "entityName": "Contest",
          "schema": {
            "$ref": "#/backend/entities/Contest"
          },
          "description": "Stores contest data. Publicly readable.",
          "params": [
            {
              "name": "contestId",
              "description": "The unique identifier for the contest."
            }
          ]
        }
      },
      {
        "path": "/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Stores event data. Includes denormalized 'organizerId' and 'attendeeIds' for authorization independence.",
          "params": [
            {
              "name": "eventId",
              "description": "The unique identifier for the event."
            }
          ]
        }
      },
      {
        "path": "/professional_applications/{applicationId}",
        "definition": {
          "entityName": "ProfessionalApplication",
          "schema": {
            "$ref": "#/backend/entities/ProfessionalApplication"
          },
          "description": "Stores applications from users wanting to become professionals. Users can create their own application. Admins can read all applications.",
          "params": [
            {
              "name": "applicationId",
              "description": "The unique identifier for the application."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure prioritizes security, scalability, and debuggability for the Sakhi Circle application. It strictly adheres to Authorization Independence by denormalizing authorization data, avoiding `get()` calls in security rules, and enabling atomic operations. Structural Segregation is used to maintain homogeneous security postures within collections, enhancing rule simplicity. Access Modeling employs consistent patterns, using path-based ownership for user-owned data and membership maps for collaborative resources. A top-level `/posts` collection has been added for efficient querying of the global feed, which is a common requirement for social applications. A new `/professional_applications` collection has been added to manage the professional onboarding workflow. \n\n**Authorization Independence:**\n\n*   **UserProfile:** User profiles are stored under `/users/{userId}`. This provides inherent ownership and eliminates the need to check parent documents for authorization. The `userId` is implicitly the document owner.\n*   **Posts:** All posts are stored in a top-level `/posts` collection. Each post document contains a denormalized `author` object with the author's ID, which allows security rules to verify ownership on writes (`create`, `update`, `delete`).\n*   **Chats & Messages:** Chats are stored in `/chats/{chatId}` with a `participants` array. Messages are stored in `/chats/{chatId}/messages/{messageId}` and inherit authorization context from the parent `chatId`. The `chats` document includes the denormalized `participants` array to avoid server-side `get()` calls in security rules.\n*   **Communities:** Communities are stored in `/communities/{communityId}` with a `memberIds` array. The leader is stored inside the document. This enables membership-based authorization. \n*   **Kitty Groups:** Kitty Groups are stored in `/kitty_groups/{kittyGroupId}` with a `memberIds` array to define group members. This membership map is leveraged for authorization. \n*   **Marketplace Listings:** Listings are stored under `/marketplace_listings/{listingId}` with a denormalized `sellerId` field. This allows rules to directly check the seller.\n*   **Directory:** Professional profiles are stored in the top-level `/directory` collection for public discovery by authenticated users.\n*   **Courses:** Courses are stored in `/courses/{courseId}` with denormalized `enrolledUserIds` and `instructorId` fields. Instructor and enrolled users can be quickly verified in rules.\n*   **Events:** Events are stored in `/events/{eventId}` with denormalized `attendeeIds` and `organizerId` fields. Organizer and attendees can be quickly verified in rules.\n*   **Professional Applications:** Applications are stored under `/professional_applications/{applicationId}`. Users can only create applications for themselves (`request.resource.data.userId == request.auth.uid`), and only admins can list/read all applications.\n\n**QAPs (Rules are not Filters):**\n\n*   **List Operations:** The data structure supports secure list operations. Listing all posts is done by querying the top-level `/posts` collection. Listing communities where a user is a member is done by querying `/communities` filtering on the `memberIds` array. Segregation of data based on ownership and clear membership maps enables efficient and secure filtering.\n\n**Invariants:**\n\n*   **Ownership:** The structure clearly defines ownership, either through denormalized fields (`author` object in `/posts`, `sellerId` in `/marketplace_listings`).\n*   **Timestamps:** Timestamps can be enforced in rules. Using serverTimestamp() is highly encouraged.\n*   **Denormalized Data:** The design explicitly defines which data is denormalized (e.g., `author`, `members` maps, `sellerId`, `instructorId`) to maintain consistency and avoid server-side reads during authorization."
  }
}

    